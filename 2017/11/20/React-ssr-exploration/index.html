<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="3W1ar6zfFsnaL1sEvDzeytVUVg5oGeuj2l0iM0svaJw">













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  

  

  

  

  

  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="React,">





  <link rel="alternate" href="/atom.xml" title="Kevin's Notes" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="在本周(11月16日)小组的前端技能分享会上，我作了主题为“React服务端渲染初探”的前端分享，分享讨论的主要内容是如何使用React完成服务器端渲染，及尝试使用 Next.js构建服务端渲染应用，也是我第一次边讲边码代码，虽然中途出了bug,但还好顺利地解决并完成了演示，本文是基于我的keynote做的分享内容总结。 #关于Isomorphic和Universal从社区的两个术语：isomor">
<meta name="keywords" content="React">
<meta property="og:type" content="article">
<meta property="og:title" content="React服务端渲染(SSR)初探">
<meta property="og:url" content="https://wuxinhua.com/2017/11/20/React-ssr-exploration/index.html">
<meta property="og:site_name" content="Kevin&#39;s Notes">
<meta property="og:description" content="在本周(11月16日)小组的前端技能分享会上，我作了主题为“React服务端渲染初探”的前端分享，分享讨论的主要内容是如何使用React完成服务器端渲染，及尝试使用 Next.js构建服务端渲染应用，也是我第一次边讲边码代码，虽然中途出了bug,但还好顺利地解决并完成了演示，本文是基于我的keynote做的分享内容总结。 #关于Isomorphic和Universal从社区的两个术语：isomor">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-12-31T12:01:49.408Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React服务端渲染(SSR)初探">
<meta name="twitter:description" content="在本周(11月16日)小组的前端技能分享会上，我作了主题为“React服务端渲染初探”的前端分享，分享讨论的主要内容是如何使用React完成服务器端渲染，及尝试使用 Next.js构建服务端渲染应用，也是我第一次边讲边码代码，虽然中途出了bug,但还好顺利地解决并完成了演示，本文是基于我的keynote做的分享内容总结。 #关于Isomorphic和Universal从社区的两个术语：isomor">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"hide","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://wuxinhua.com/2017/11/20/React-ssr-exploration/">





  <title>React服务端渲染(SSR)初探 | Kevin's Notes</title>
  













</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146717212-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-146717212-1');
</script>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kevin's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button role="presentation">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archive
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wuxinhua.com/2017/11/20/React-ssr-exploration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuxinhua">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kevin's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">React服务端渲染(SSR)初探</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T11:16:30+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在本周(11月16日)小组的前端技能分享会上，我作了主题为“React服务端渲染初探”的前端分享，分享讨论的主要内容是如何使用React完成服务器端渲染，及尝试使用 Next.js构建服务端渲染应用，也是我第一次边讲边码代码，虽然中途出了bug,但还好顺利地解决并完成了演示，本文是基于我的keynote做的分享内容总结。</p>
<h5 id="关于Isomorphic和Universal"><a href="#关于Isomorphic和Universal" class="headerlink" title="#关于Isomorphic和Universal"></a>#关于Isomorphic和Universal</h5><p>从社区的两个术语：isomorphic(同构) 和 universal(通用)开始本篇文章:</p>
<blockquote>
<p>“Isomorphic means running the same code on the client and the server.”  </p>
<p>“Universal means that it runs not only on servers and browsers, but on native devices and embedded architectures as well.”  </p>
</blockquote>
<p>“Isomorphic JavaScript”表示JavaScript代码可以在Server及Client两端执行。<br>在目前社区最火的几个前端框架中，不管是Angular还是React，在github上都会有很多带这两个关键字的脚手架和示例，前端同构慢慢变成了一种流行的构建方式；React比较吸引我的地方之一就在于它的客户端-服务端“同构”特征，React的组件、代码能够实现最大程度的复用，而服务端渲染就是同构的一个非常好的例子；在Node.js出现之前，前端开发的主要语言和技能是HTML/CSS/Javascript,后端一般基于Java/PHP等语言，在PHP和JSP/ASP大行其道的时候，一切内容都是服务端渲染；随着前端技术、框架的发展和崛起，为了节省服务器资源，出现了前后端分离的模式，各端专注于自己的那一部分；再后来Node.js给我们带来了在服务端使用Javascript的机会，Javascript慢慢渗透到服务端，前后端同构的方式再次被拿出来讨论并实践。  </p>
<p>在计算机科学领域，有两大难题，如何让缓存失效(cache invalidation)和如何给各种东西命名，确实“同构”这个词并不是很直观，有一定的局限性，于是就有人提出给它换个名称，Micheal Jackson(<a href="https://github.com/mjackson" target="_blank" rel="noopener">@mjackson</a>) 提出了使用“Universal JavaScript”作為新的命名，意在说明不仅仅是客户端和服务端，而是所有地方;但我个人认为Universal这个词过于宽泛了，对于我们来说仍然是一头雾水，具体可以在React上查看这个<a href="https://github.com/facebook/react/pull/4041#issuecomment-109420008" target="_blank" rel="noopener">pr</a>。   </p>
<h5 id="什么是服务端渲染-SRR-？"><a href="#什么是服务端渲染-SRR-？" class="headerlink" title="#什么是服务端渲染(SRR)？"></a>#什么是服务端渲染(SRR)？</h5><p>SSR(Server side Render)服务端渲染，顾名思义页面的渲染工作将在服务端完成，目前通常有两种选择：SSR(服务器渲染) 与 CSR(客户端渲染)，无论哪种方式，最终用户所看到的页面是一致的。（以下SSR代表服务端渲染、CSR代表客户端渲染）</p>
<h5 id="CSR-vs-SSR"><a href="#CSR-vs-SSR" class="headerlink" title="#CSR vs SSR"></a>#CSR vs SSR</h5><ol>
<li>原本由服务器执行的渲染任务转移给了客户端，这在大量用户访问的时候大大减轻后端的压力。让后端专注做后端应该做的事情，性能将大大提高。</li>
<li>随着这些年Javascript的崛起，特别是在Node.js出现以后 JS 工程师 维护后端的成本大大降低。</li>
<li>最大的区别在于使用SSR情况下服务器端发送给前端的是已经<br>准备好的HTML页面；无需等待Javascript下载和执行完。  </li>
<li>使用SSR会页面会提前渲染好，用户能更早得看到页面，但在JavaScript加载执行完之前，页面仍然是不可交互的，比如在这个区间点击某个按钮，并不会触发起效。</li>
</ol>
<h6 id="客户端渲染"><a href="#客户端渲染" class="headerlink" title="#客户端渲染"></a>#客户端渲染</h6><p>（以基于React做的SPA的页面为例说明加载和渲染过程）<br>1）客户端请求页面资源 ；<br>2）服务器先返回index.html模板页面；<br>3）请求JS、CSS等其他文件；<br>4）React执行,组件根据生命周期做一些数据加载初始化操作；<br>5）React渲染组件呈现页面；（页面可见、可交互）  </p>
<p>在Chrome设置的“Debugger”里禁掉“Disable JavaScript”选项，会发现客户端只接受到一个HTML文件和对应css文件，但页面并没有实际内容，由于传统的搜索引擎只会从 HTML 中抓取数据，导致前端渲染的页面无法被抓取。在没有缓存和网速不给力的情况下，还会出现白屏现象，让用户等待白屏结束并非一个很好的体验，总结一下即两个缺点：<br>a.不利于SEO；<br>b.首屏体验不佳； </p>
<h6 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="#服务端渲染"></a>#服务端渲染</h6><p>1）客户端请求页面资源；<br>2）服务端请求页面所需数据；<br>3）服务器把渲染页面,返回给浏览器端；（页面可见）<br>4）客户端请求JS和CSS等其它资源；（页面可见）<br>5）React渲染组件呈现页面；（页面可见、可交互）<br><strong>优点</strong>：<br>a.利于SEO，服务器端渲染可以让搜索引擎更容易读取页面的meta信息以及其他SEO相关信息，大大增加网站在搜索引擎中的可见度。<br>b.减少页面初始化的加载时间；<br>c.同构的思想，代码复用，便于维护；<br>c.服务端渲染会给服务端造成一定的压力；</p>
<h5 id="SSR应用场景"><a href="#SSR应用场景" class="headerlink" title="#SSR应用场景"></a>#SSR应用场景</h5><p>1）需要SEO优化的页面;<br>2）内容到达时间(time-to-content)与转换率直接相关的业务;<br>3）首屏数据量较大的页面;</p>
<h5 id="React服务端渲染原理"><a href="#React服务端渲染原理" class="headerlink" title="#React服务端渲染原理"></a>#React服务端渲染原理</h5><p>React提供renderToString 和 renderToStaticMarkup方法用于将Virtual DOM渲染成HTML字符串，服务端渲染出来的只是静态DOM，还不能使用React、Redux等定义的State, props,事件等，必须在客户端实例化React,而在客户端渲染之前需要获取页面初始化所需的数据。    </p>
<p><strong>renderToString和renderToStaticMarkup的区别</strong>：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">renderToString(react element)</span><br><span class="line">renderToStaticMarkup(react element)</span><br></pre></td></tr></table></figure></p>
<p>两个方法均接受React组件作为参数，使用 renderToStaticMarkup 渲染出的是不带data-reactid的纯html，在前端react.js加载完成后,之前服务端渲染的页面会抹掉之前服务端的重新渲染(可能页面会闪一下)，换句话说前端React不认识之前服务端渲染的内容,render方法会使用innerHTML的方法重写#react-target里的内容；</p>
<p>而使用renderToString方法渲染的节点会带有data-reactid属性,在前端React加载完成后, 前端React会认识之前服务端渲染的内容,不会重新渲染DOM节点,React接管页面,执行 componentDidMout绑定浏览器事件等这些在服务端没完成也不可能执行任务；</p>
<h5 id="如何搭建基于React的服务端渲染应用"><a href="#如何搭建基于React的服务端渲染应用" class="headerlink" title="#如何搭建基于React的服务端渲染应用"></a>#如何搭建基于React的服务端渲染应用</h5><p><strong>利用React + Express实现</strong>：</p>
<p>1）结合React、React-router、Webpack等搭建一个服务端渲染项目；<br>2）利用ReactDOMServer.renderToString 和renderToStaticMarkup方法；<br>3）React-router提供对应了对应服务端渲染方案；<br>4）使用express搭建web服务器；  </p>
<p><strong>利用网上的集成框架</strong></p>
<p>例如<a href="https://zeit.co/about" target="_blank" rel="noopener">Nextjs</a>。</p>
<p>以结合React + Express + RR + Redux实现服务端渲染为例子，看下这个过程需要注意哪些问题： </p>
<p>1) React.renderToString是同步的，所以没有办法使用组件的任何一个生命周期方法，来获取异步的数据？  </p>
<p>2) 使用Redux过程中，客户端组件需要从我们的store中拿一个初始化的状态值，即<strong>INITIAL_STATE</strong>  </p>
<p>3) 前端有对应的路由库，服务器端渲染怎么处理页面跳转？  </p>
<p><strong>对应问题的解决方案</strong>：</p>
<p>1）在组件内定义static方法异步请求数据，渲染前先执行请求获取页面初始数据；</p>
<p>2）Server端获取初始数据 =&gt; ReactDOMServer.renderToString(<app>) =&gt; 获取初始state插入模板中=&gt; Client代码获取window.INITIAL_STATE =&gt; 注入<provider store="{initState}"> =&gt; 前端React接管页面</provider></app></p>
<p>3）根据对应的rul路径，返回对应的组件，路由问题可以交由React-router解决，React-router为服务端渲染提供了对应的解决方法，可以查看下面两个例子：</p>
<p>v3版本中在服务器端用一个 match 方法将拿到的 request url 匹配到我们之前定义的 routes，解析成和客户端一致的 props 对象传递给组件。<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// V3 版本使用match方法</span></span><br><span class="line"><span class="keyword">const</span> ReactRouterContext = React.createFactory(RouterContext);</span><br><span class="line"><span class="keyword">const</span> ReduxProvider = React.createFactory(Provider);</span><br><span class="line">match(&#123; routes, <span class="attr">location</span>: req.url &#125;, (err, redirectLocation, renderProps) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.status(<span class="number">503</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (redirectLocation) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="number">302</span>, redirectLocation.pathname + redirectLocation.search);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (renderProps) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">`&lt;!DOCTYPE html&gt;<span class="subst">$&#123;ReactDOMServer.renderToString(</span></span></span><br><span class="line"><span class="string"><span class="subst">          ReduxProvider(&#123; store &#125;</span>, ReactRouterContext(renderProps)))&#125;`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// v4版match方法已弃用</span></span><br><span class="line"><span class="keyword">const</span> context = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> markup = ReactDOMServer.renderToString(</span><br><span class="line">  &lt;StaticRouter</span><br><span class="line">    location=&#123;req.url&#125;</span><br><span class="line">    context=&#123;context&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;App/&gt;</span><br><span class="line">  &lt;<span class="regexp">/StaticRouter&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">if (context.url) &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ Somewhere a `&lt;Redirect&gt;` was rendered</span></span><br><span class="line"><span class="regexp">  redirect(301, context.url)</span></span><br><span class="line"><span class="regexp">&#125; else &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ we're good, send the response</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="整合Redux、React-router、Express"><a href="#整合Redux、React-router、Express" class="headerlink" title="#整合Redux、React-router、Express"></a>#整合Redux、React-router、Express</h5><p>后端使用express搭建服务器，为前端提供静态资源服务：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Express服务器</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> render = <span class="built_in">require</span>(<span class="string">'./handleServerRender.js'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">2048</span>;</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/dist'</span>, express.static(<span class="string">'./dist'</span>));</span><br><span class="line">app.use(<span class="string">'*'</span>, render.handleRender);</span><br><span class="line"></span><br><span class="line">app.listen(port, ()=&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`🌎  SSR Listening on port <span class="subst">$&#123;port&#125;</span>.`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>配合Redux:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 客户端 app.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;history, store&#125; = <span class="keyword">this</span>.props</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;BaseLayout&gt;</span><br><span class="line">                &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                    &lt;ConnectedRouter history=&#123;history&#125;&gt;</span><br><span class="line">                        &lt;RootRouters location=&#123;location&#125; /&gt; </span><br><span class="line">                    &lt;<span class="regexp">/ConnectedRouter&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Provider&gt;</span><br><span class="line">            &lt;<span class="regexp">/BaseLayout&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">    App.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">        store: PropTypes.object.isRequired,</span></span><br><span class="line"><span class="regexp">        history: PropTypes.object.isRequired</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">export default App</span></span><br></pre></td></tr></table></figure>
<p>渲染前通过调用static定义静态方法获取页面初始化数据，服务端配合React-router的renderRoutes进行页面组件渲染，注意React-router v4版变化较大，之前的方法已经被弃用： </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// preFetchData.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> preFetchData = <span class="function">(<span class="params">store, location</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> branch = matchRoutes(routes, location);</span><br><span class="line">    <span class="keyword">const</span> promises = branch.map(<span class="function">(<span class="params">&#123; route, match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(route.component) &#123;</span><br><span class="line">            route.component.prefetch</span><br><span class="line">            ? route.component.prefetch(store, match)</span><br><span class="line">            : <span class="built_in">Promise</span>.resolve(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br>使用React-router提供的服务端渲染方法：<br><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// handleServerRender.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> handleRender = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = createMemoryHistory()</span><br><span class="line">    <span class="keyword">const</span> store = createdStore(<span class="string">''</span>, history)</span><br><span class="line">    <span class="keyword">const</span> initialState = store.getState()</span><br><span class="line">    <span class="keyword">return</span> preFetchData(store, res.url)</span><br><span class="line">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> componentHtml = renderToString(</span><br><span class="line">                &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                    &lt;ConnectedRouter history=&#123;history&#125;&gt;</span><br><span class="line">                         &lt;div&gt;</span><br><span class="line">                            &#123;renderRoutes(routes, &#123; ...data &#125;)&#125;</span><br><span class="line">                        &lt;<span class="regexp">/div&gt; </span></span><br><span class="line"><span class="regexp">                    &lt;/</span>ConnectedRouter&gt;</span><br><span class="line">                &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">            )</span></span><br><span class="line"><span class="regexp">            return res.status(200).send(</span></span><br><span class="line"><span class="regexp">                html(componentHtml, initialState)</span></span><br><span class="line"><span class="regexp">            ); </span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">        .catch((err) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            console.log(err);</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>在返回静态字符串模板函数里，将初始state挂载在window上，方便客户端渲染时，Redux的createStore方法进行调用:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 服务端html.js</span></span><br><span class="line">&lt;script&gt; <span class="built_in">window</span>.__INITIAL_STATE__ = $&#123;<span class="built_in">JSON</span>.stringify(state)&#125; &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 客户端createStore.jss</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125;  <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">const</span> createdStore = <span class="function">(<span class="params">initState, history</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> middleware = [routerMiddleware(history)]</span><br><span class="line">    <span class="keyword">const</span> initialState = initState || &#123;&#125;;</span><br><span class="line">    <span class="comment">// config._ENV_ === 'development' ?</span></span><br><span class="line">    <span class="comment">//     middleware.push(createLogger()) : null</span></span><br><span class="line">    <span class="keyword">const</span> store = createStore(</span><br><span class="line">        reducer,</span><br><span class="line">        initialState,</span><br><span class="line">        applyMiddleware(...middleware)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createdStore</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React渲染root节点main.js</span></span><br><span class="line"><span class="keyword">const</span> MOUNT_NODE = <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> history = createHistory()</span><br><span class="line">    <span class="keyword">const</span> initialState = <span class="built_in">window</span>.__INITIAL_STATE__</span><br><span class="line">    <span class="keyword">const</span> store = createdStore(initialState,history)</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App </span><br><span class="line">            history=&#123;history&#125;</span><br><span class="line">            store=&#123;store&#125;</span><br><span class="line">        /&gt;, </span><br><span class="line">        MOUNT_NODE</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render()</span><br></pre></td></tr></table></figure>
<h5 id="关于Next-js"><a href="#关于Next-js" class="headerlink" title="#关于Next.js"></a>#关于Next.js</h5><p>Next.js是一个小巧的基于React、Webpack、Babel的客户端渲染universal JavasScript web app框架，体验之后它给我的感觉就是它提供了一种便利的方式来创建新的Web应用，足够简单，并且零配置，你不用在配置Webpack、Babel等上浪费太多的时间，所有的东西框架都已经给你准备好，当然它也支持开发者对其中的一些配置进行扩展。<br>总结一下Next.js的特征：</p>
<p>1）服务器端渲染(默认);<br>2）自动代码切分, 加速页面加载;<br>3）简单的客户端路由(基于页面);<br>4）基于Webpack的开发环境, 支持热模块替换(HMR: Hot Module Replacement);<br>5）可以使用Express 或其他Node.js服务器实现;<br>6）使用Babel和Webpack配置定制;  </p>
<h5 id="使用Next-js搭建SSR项目"><a href="#使用Next-js搭建SSR项目" class="headerlink" title="#使用Next.js搭建SSR项目"></a>#使用Next.js搭建SSR项目</h5><p>从零开始搭建一个基于Next.js的web项目：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// 在本地创建一个项目根目录</span><br><span class="line">$ mkdir react-next-example</span><br><span class="line"></span><br><span class="line">// 切换到项目根目录</span><br><span class="line">$ <span class="built_in">cd</span> react-next-example</span><br><span class="line"></span><br><span class="line">// 用npm初始化项目</span><br><span class="line">$ npm init -y</span><br><span class="line"></span><br><span class="line">// 将react和next安装到本地依赖</span><br><span class="line">$ cnpm i --save react react-dom next</span><br><span class="line"></span><br><span class="line">// 创建路由文件夹pages</span><br><span class="line">$ mkdir pages</span><br><span class="line"></span><br><span class="line">// 写入index.js页面</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> pages</span><br><span class="line">$ vi index.js</span><br></pre></td></tr></table></figure>
<p>添加如下代码<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cssStyle = &#123;</span><br><span class="line">    color: <span class="string">'red'</span>,</span><br><span class="line">    fontSize: <span class="string">'25px'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h3 style=&#123;cssStyle&#125;&gt;Home page&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// vi package.json添加运行命令</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"next"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 执行命令,在浏览器3000端口访问该页面</span><br><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>
<h5 id="Next-js实践总结"><a href="#Next-js实践总结" class="headerlink" title="Next.js实践总结"></a>Next.js实践总结</h5><p>相比于自己搭建Express服务器来实现服务端的渲染，Next.js直接一步到位，帮我们做了很多工作，在使用Next.js的时候，回头再来看一下Next.js是如何处理下面几个问题的：  </p>
<h6 id="如何获取初始化数据Props和状态State"><a href="#如何获取初始化数据Props和状态State" class="headerlink" title="如何获取初始化数据Props和状态State?"></a>如何获取初始化数据Props和状态State?</h6><p>Next.js提供了getInitialProps方便获取初始数据，你可以把它当成组件的内的一个静态方法，可以这样定义它：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> getInitialProps() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">data</span>: <span class="string">"List Data"</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者这样：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> List = <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &lt;div&gt;&#123;data&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">Foo.getInitialProps = () =&gt; (&#123; data: "List Data" &#125;);</span></span><br></pre></td></tr></table></figure></p>
<h6 id="如何处理Ajax异步请求"><a href="#如何处理Ajax异步请求" class="headerlink" title="如何处理Ajax异步请求?"></a>如何处理Ajax异步请求?</h6><p>getInitialProps使我们能够获取页面所需的数据，这些数据有可能是需要使用Ajax从接口服务中获取，在Next.js中可以使用Promise来进行异步请求，当然你还可以使用async/await来实现：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> index = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Link  href=&#123;<span class="string">`/list?id=<span class="subst">$&#123;id&#125;</span>`</span>&#125;&gt;to list page&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">        &#123; props.strike ? props.strike.map((item, index) =&gt; &lt;div key=&#123;index&#125;&gt;</span></span><br><span class="line"><span class="regexp">            &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li&gt;&#123;item.country&#125;&lt;/</span>li&gt;</span><br><span class="line">                &lt;li&gt;&#123;item.location&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li&gt;&#123;item.date&#125;&lt;/</span>li&gt;</span><br><span class="line">            &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;): <span class="literal">undefined</span> &#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">index.getInitialProps = async function() &#123;</span></span><br><span class="line"><span class="regexp">    const res = await fetch(`http:/</span><span class="regexp">/api.dronestre.am/</span>data<span class="string">`, ...headers)</span></span><br><span class="line"><span class="string">    const data = await res.json()</span></span><br><span class="line"><span class="string">    const strike = data.strike.slice(0,10)</span></span><br><span class="line"><span class="string">    return &#123; strike:  strike&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h6 id="路由的处理"><a href="#路由的处理" class="headerlink" title="路由的处理?"></a>路由的处理?</h6><p>Next.js基于文件目录结构作为路由，实现前端页面跳转，所以每个放到pages文件夹中的组件将会自动映射为一个基于服务器的路由，比如磁盘上的pages/about.js组件将会自动服务于/about这个URL。这套路由比React-router系统简单明了,无需再写额外的代码组织路由，但个人认为缺点在于当路由结构较复杂时候，文件结构的嵌套也会变得复杂，不便于维护。举例如下：   </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 所有路由基于pages文件夹下的文件目录结构：</span></span><br><span class="line">.</span><br><span class="line">├── pages                       # pages文件夹</span><br><span class="line">│   ├── index.js                # index页面，也是/默认访问页面,如果没有找到资源会跳转到Next.js自带的404页面</span><br><span class="line">│   ├── list.js                 # list页面，通过/list能访问该页面</span><br><span class="line">│   ├── test-page.js            # test-page页面，通过/test-page 能访问该页面,'-'和‘_’均支持</span><br><span class="line">│   └── home                    # index.js页面，也是/默认访问页面</span><br><span class="line">│       └── home.js             # home页面，通过/home无法访问到该页面</span><br><span class="line">│       └── index.js            # home页面，通过/home能访问到该页面</span><br></pre></td></tr></table></figure>
<h6 id="CSS的实现"><a href="#CSS的实现" class="headerlink" title="CSS的实现"></a>CSS的实现</h6><p>Next.js提供两种方案来实现CSS的模块化，一种是styled-jsx方式，另一种是CSS-in-JS：<br>styled-jsx形式：  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    Hello world</span><br><span class="line">    &lt;p&gt;scoped!<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &lt;style jsx&gt;&#123;<span class="string">`</span></span><br><span class="line"><span class="string">      p &#123;</span></span><br><span class="line"><span class="string">        color: blue;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      div &#123;</span></span><br><span class="line"><span class="string">        background: red;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      @media (max-width: 600px) &#123;</span></span><br><span class="line"><span class="string">        div &#123;</span></span><br><span class="line"><span class="string">          background: blue;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>&#125;&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">    &lt;style global jsx&gt;&#123;`</span></span><br><span class="line"><span class="regexp">      body &#123;</span></span><br><span class="line"><span class="regexp">        background: black;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    `&#125;&lt;/</span>style&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>CSS-in-JS方式：  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> '<span class="attr">red</span>' &#125;&#125;&gt;</span>hi there<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>或者这样：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cssStyle = &#123;</span><br><span class="line">    color: <span class="string">'red'</span>,</span><br><span class="line">    fontSize: <span class="string">'25px'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h3 style=&#123;cssStyle&#125;&gt;Test page&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>附参考资料：  </p>
<p><a href="https://medium.com/@mjackson/universal-javascript-4761051b7ae9" target="_blank" rel="noopener">1.Universal JavaScript</a><br><a href="https://ebaytech.berlin/universal-web-apps-with-react-router-4-15002bb30ccb" target="_blank" rel="noopener">2.Universal JavaScript Apps with React Router 4</a><br><a href="https://learnnextjs.com/" target="_blank" rel="noopener">3.Start Learning Next.js to build server rendered JS web apps with React</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      wuxinhua
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://wuxinhua.com/2017/11/20/React-ssr-exploration/" title="React服务端渲染(SSR)初探">https://wuxinhua.com/2017/11/20/React-ssr-exploration/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。任何人可以进行转载、分享，但不可在未经允许的情况下用于商业用途！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/React/" rel="tag"># React</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/24/What-happen-from-input-the-URL-in-the-browser-to-the-page-bring-out-part2/" rel="next" title="从面试题“输入URL...发生了什么”学到的(下)">
                <i class="fa fa-chevron-left"></i> 从面试题“输入URL...发生了什么”学到的(下)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/13/The-think-of-sort-algorithms/" rel="prev" title="对比几种常见的排序算法">
                对比几种常见的排序算法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="wuxinhua">
          <p class="site-author-name" itemprop="name">wuxinhua</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#关于Isomorphic和Universal"><span class="nav-number">1.</span> <span class="nav-text">#关于Isomorphic和Universal</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是服务端渲染-SRR-？"><span class="nav-number">2.</span> <span class="nav-text">#什么是服务端渲染(SRR)？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CSR-vs-SSR"><span class="nav-number">3.</span> <span class="nav-text">#CSR vs SSR</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#客户端渲染"><span class="nav-number">3.1.</span> <span class="nav-text">#客户端渲染</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#服务端渲染"><span class="nav-number">3.2.</span> <span class="nav-text">#服务端渲染</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SSR应用场景"><span class="nav-number">4.</span> <span class="nav-text">#SSR应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#React服务端渲染原理"><span class="nav-number">5.</span> <span class="nav-text">#React服务端渲染原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如何搭建基于React的服务端渲染应用"><span class="nav-number">6.</span> <span class="nav-text">#如何搭建基于React的服务端渲染应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#整合Redux、React-router、Express"><span class="nav-number">7.</span> <span class="nav-text">#整合Redux、React-router、Express</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关于Next-js"><span class="nav-number">8.</span> <span class="nav-text">#关于Next.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用Next-js搭建SSR项目"><span class="nav-number">9.</span> <span class="nav-text">#使用Next.js搭建SSR项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Next-js实践总结"><span class="nav-number">10.</span> <span class="nav-text">Next.js实践总结</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#如何获取初始化数据Props和状态State"><span class="nav-number">10.1.</span> <span class="nav-text">如何获取初始化数据Props和状态State?</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#如何处理Ajax异步请求"><span class="nav-number">10.2.</span> <span class="nav-text">如何处理Ajax异步请求?</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#路由的处理"><span class="nav-number">10.3.</span> <span class="nav-text">路由的处理?</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#CSS的实现"><span class="nav-number">10.4.</span> <span class="nav-text">CSS的实现</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="author" itemprop="copyrightHolder">Created with </span>
  <span class="with-love">
    <i class="fa fa-heart"></i> 
  </span> by <a class="theme-link" href="https://github.com/M1seRy">
     wuxinhua
   </a>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

 <div class="theme-info">
  Host by
    <a class="theme-link" href="https://www.aliyun.com/">
    Aliyun 
   </a>
 </div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>











  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  

  

  

  

  

  <div class="galleria"></div>
<script type="text/javascript">
    console.log('人生如逆旅，我亦是行人。')
</script>
  
</body>
</html>
